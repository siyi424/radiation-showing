{"ast":null,"code":"import LRU from '../../core/LRU.js';\nimport { platformApi } from '../../core/platform.js';\nvar globalImageCache = new LRU(50);\nexport function findExistImage(newImageOrSrc) {\n  if (typeof newImageOrSrc === 'string') {\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    return cachedImgObj && cachedImgObj.image;\n  } else {\n    return newImageOrSrc;\n  }\n}\nexport function createOrUpdateImage(newImageOrSrc, image, hostEl, onload, cbPayload) {\n  if (!newImageOrSrc) {\n    return image;\n  } else if (typeof newImageOrSrc === 'string') {\n    if (image && image.__zrImageSrc === newImageOrSrc || !hostEl) {\n      return image;\n    }\n\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    var pendingWrap = {\n      hostEl: hostEl,\n      cb: onload,\n      cbPayload: cbPayload\n    };\n\n    if (cachedImgObj) {\n      image = cachedImgObj.image;\n      !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n    } else {\n      image = platformApi.loadImage(newImageOrSrc, imageOnLoad, imageOnLoad);\n      image.__zrImageSrc = newImageOrSrc;\n      globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n        image: image,\n        pending: [pendingWrap]\n      });\n    }\n\n    return image;\n  } else {\n    return newImageOrSrc;\n  }\n}\n\nfunction imageOnLoad() {\n  var cachedImgObj = this.__cachedImgObj;\n  this.onload = this.onerror = this.__cachedImgObj = null;\n\n  for (var i = 0; i < cachedImgObj.pending.length; i++) {\n    var pendingWrap = cachedImgObj.pending[i];\n    var cb = pendingWrap.cb;\n    cb && cb(this, pendingWrap.cbPayload);\n    pendingWrap.hostEl.dirty();\n  }\n\n  cachedImgObj.pending.length = 0;\n}\n\nexport function isImageReady(image) {\n  return image && image.width && image.height;\n}","map":{"version":3,"names":["LRU","platformApi","globalImageCache","findExistImage","newImageOrSrc","cachedImgObj","get","image","createOrUpdateImage","hostEl","onload","cbPayload","__zrImageSrc","pendingWrap","cb","isImageReady","pending","push","loadImage","imageOnLoad","put","__cachedImgObj","onerror","i","length","dirty","width","height"],"sources":["/home/siyi/Projects/radi-demo/radi-showing/node_modules/zrender/lib/graphic/helper/image.js"],"sourcesContent":["import LRU from '../../core/LRU.js';\nimport { platformApi } from '../../core/platform.js';\nvar globalImageCache = new LRU(50);\nexport function findExistImage(newImageOrSrc) {\n    if (typeof newImageOrSrc === 'string') {\n        var cachedImgObj = globalImageCache.get(newImageOrSrc);\n        return cachedImgObj && cachedImgObj.image;\n    }\n    else {\n        return newImageOrSrc;\n    }\n}\nexport function createOrUpdateImage(newImageOrSrc, image, hostEl, onload, cbPayload) {\n    if (!newImageOrSrc) {\n        return image;\n    }\n    else if (typeof newImageOrSrc === 'string') {\n        if ((image && image.__zrImageSrc === newImageOrSrc) || !hostEl) {\n            return image;\n        }\n        var cachedImgObj = globalImageCache.get(newImageOrSrc);\n        var pendingWrap = { hostEl: hostEl, cb: onload, cbPayload: cbPayload };\n        if (cachedImgObj) {\n            image = cachedImgObj.image;\n            !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n        }\n        else {\n            image = platformApi.loadImage(newImageOrSrc, imageOnLoad, imageOnLoad);\n            image.__zrImageSrc = newImageOrSrc;\n            globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n                image: image,\n                pending: [pendingWrap]\n            });\n        }\n        return image;\n    }\n    else {\n        return newImageOrSrc;\n    }\n}\nfunction imageOnLoad() {\n    var cachedImgObj = this.__cachedImgObj;\n    this.onload = this.onerror = this.__cachedImgObj = null;\n    for (var i = 0; i < cachedImgObj.pending.length; i++) {\n        var pendingWrap = cachedImgObj.pending[i];\n        var cb = pendingWrap.cb;\n        cb && cb(this, pendingWrap.cbPayload);\n        pendingWrap.hostEl.dirty();\n    }\n    cachedImgObj.pending.length = 0;\n}\nexport function isImageReady(image) {\n    return image && image.width && image.height;\n}\n"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,mBAAhB;AACA,SAASC,WAAT,QAA4B,wBAA5B;AACA,IAAIC,gBAAgB,GAAG,IAAIF,GAAJ,CAAQ,EAAR,CAAvB;AACA,OAAO,SAASG,cAAT,CAAwBC,aAAxB,EAAuC;EAC1C,IAAI,OAAOA,aAAP,KAAyB,QAA7B,EAAuC;IACnC,IAAIC,YAAY,GAAGH,gBAAgB,CAACI,GAAjB,CAAqBF,aAArB,CAAnB;IACA,OAAOC,YAAY,IAAIA,YAAY,CAACE,KAApC;EACH,CAHD,MAIK;IACD,OAAOH,aAAP;EACH;AACJ;AACD,OAAO,SAASI,mBAAT,CAA6BJ,aAA7B,EAA4CG,KAA5C,EAAmDE,MAAnD,EAA2DC,MAA3D,EAAmEC,SAAnE,EAA8E;EACjF,IAAI,CAACP,aAAL,EAAoB;IAChB,OAAOG,KAAP;EACH,CAFD,MAGK,IAAI,OAAOH,aAAP,KAAyB,QAA7B,EAAuC;IACxC,IAAKG,KAAK,IAAIA,KAAK,CAACK,YAAN,KAAuBR,aAAjC,IAAmD,CAACK,MAAxD,EAAgE;MAC5D,OAAOF,KAAP;IACH;;IACD,IAAIF,YAAY,GAAGH,gBAAgB,CAACI,GAAjB,CAAqBF,aAArB,CAAnB;IACA,IAAIS,WAAW,GAAG;MAAEJ,MAAM,EAAEA,MAAV;MAAkBK,EAAE,EAAEJ,MAAtB;MAA8BC,SAAS,EAAEA;IAAzC,CAAlB;;IACA,IAAIN,YAAJ,EAAkB;MACdE,KAAK,GAAGF,YAAY,CAACE,KAArB;MACA,CAACQ,YAAY,CAACR,KAAD,CAAb,IAAwBF,YAAY,CAACW,OAAb,CAAqBC,IAArB,CAA0BJ,WAA1B,CAAxB;IACH,CAHD,MAIK;MACDN,KAAK,GAAGN,WAAW,CAACiB,SAAZ,CAAsBd,aAAtB,EAAqCe,WAArC,EAAkDA,WAAlD,CAAR;MACAZ,KAAK,CAACK,YAAN,GAAqBR,aAArB;MACAF,gBAAgB,CAACkB,GAAjB,CAAqBhB,aAArB,EAAoCG,KAAK,CAACc,cAAN,GAAuB;QACvDd,KAAK,EAAEA,KADgD;QAEvDS,OAAO,EAAE,CAACH,WAAD;MAF8C,CAA3D;IAIH;;IACD,OAAON,KAAP;EACH,CAnBI,MAoBA;IACD,OAAOH,aAAP;EACH;AACJ;;AACD,SAASe,WAAT,GAAuB;EACnB,IAAId,YAAY,GAAG,KAAKgB,cAAxB;EACA,KAAKX,MAAL,GAAc,KAAKY,OAAL,GAAe,KAAKD,cAAL,GAAsB,IAAnD;;EACA,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlB,YAAY,CAACW,OAAb,CAAqBQ,MAAzC,EAAiDD,CAAC,EAAlD,EAAsD;IAClD,IAAIV,WAAW,GAAGR,YAAY,CAACW,OAAb,CAAqBO,CAArB,CAAlB;IACA,IAAIT,EAAE,GAAGD,WAAW,CAACC,EAArB;IACAA,EAAE,IAAIA,EAAE,CAAC,IAAD,EAAOD,WAAW,CAACF,SAAnB,CAAR;IACAE,WAAW,CAACJ,MAAZ,CAAmBgB,KAAnB;EACH;;EACDpB,YAAY,CAACW,OAAb,CAAqBQ,MAArB,GAA8B,CAA9B;AACH;;AACD,OAAO,SAAST,YAAT,CAAsBR,KAAtB,EAA6B;EAChC,OAAOA,KAAK,IAAIA,KAAK,CAACmB,KAAf,IAAwBnB,KAAK,CAACoB,MAArC;AACH"},"metadata":{},"sourceType":"module"}