{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util.js';\nimport * as numberUtil from '../../util/number.js';\nexport default function themeRiverLayout(ecModel, api) {\n  ecModel.eachSeriesByType('themeRiver', function (seriesModel) {\n    var data = seriesModel.getData();\n    var single = seriesModel.coordinateSystem;\n    var layoutInfo = {}; // use the axis boundingRect for view\n\n    var rect = single.getRect();\n    layoutInfo.rect = rect;\n    var boundaryGap = seriesModel.get('boundaryGap');\n    var axis = single.getAxis();\n    layoutInfo.boundaryGap = boundaryGap;\n\n    if (axis.orient === 'horizontal') {\n      boundaryGap[0] = numberUtil.parsePercent(boundaryGap[0], rect.height);\n      boundaryGap[1] = numberUtil.parsePercent(boundaryGap[1], rect.height);\n      var height = rect.height - boundaryGap[0] - boundaryGap[1];\n      doThemeRiverLayout(data, seriesModel, height);\n    } else {\n      boundaryGap[0] = numberUtil.parsePercent(boundaryGap[0], rect.width);\n      boundaryGap[1] = numberUtil.parsePercent(boundaryGap[1], rect.width);\n      var width = rect.width - boundaryGap[0] - boundaryGap[1];\n      doThemeRiverLayout(data, seriesModel, width);\n    }\n\n    data.setLayout('layoutInfo', layoutInfo);\n  });\n}\n/**\n * The layout information about themeriver\n *\n * @param data  data in the series\n * @param seriesModel  the model object of themeRiver series\n * @param height  value used to compute every series height\n */\n\nfunction doThemeRiverLayout(data, seriesModel, height) {\n  if (!data.count()) {\n    return;\n  }\n\n  var coordSys = seriesModel.coordinateSystem; // the data in each layer are organized into a series.\n\n  var layerSeries = seriesModel.getLayerSeries(); // the points in each layer.\n\n  var timeDim = data.mapDimension('single');\n  var valueDim = data.mapDimension('value');\n  var layerPoints = zrUtil.map(layerSeries, function (singleLayer) {\n    return zrUtil.map(singleLayer.indices, function (idx) {\n      var pt = coordSys.dataToPoint(data.get(timeDim, idx));\n      pt[1] = data.get(valueDim, idx);\n      return pt;\n    });\n  });\n  var base = computeBaseline(layerPoints);\n  var baseLine = base.y0;\n  var ky = height / base.max; // set layout information for each item.\n\n  var n = layerSeries.length;\n  var m = layerSeries[0].indices.length;\n  var baseY0;\n\n  for (var j = 0; j < m; ++j) {\n    baseY0 = baseLine[j] * ky;\n    data.setItemLayout(layerSeries[0].indices[j], {\n      layerIndex: 0,\n      x: layerPoints[0][j][0],\n      y0: baseY0,\n      y: layerPoints[0][j][1] * ky\n    });\n\n    for (var i = 1; i < n; ++i) {\n      baseY0 += layerPoints[i - 1][j][1] * ky;\n      data.setItemLayout(layerSeries[i].indices[j], {\n        layerIndex: i,\n        x: layerPoints[i][j][0],\n        y0: baseY0,\n        y: layerPoints[i][j][1] * ky\n      });\n    }\n  }\n}\n/**\n * Compute the baseLine of the rawdata\n * Inspired by Lee Byron's paper Stacked Graphs - Geometry & Aesthetics\n *\n * @param  data  the points in each layer\n */\n\n\nfunction computeBaseline(data) {\n  var layerNum = data.length;\n  var pointNum = data[0].length;\n  var sums = [];\n  var y0 = [];\n  var max = 0;\n\n  for (var i = 0; i < pointNum; ++i) {\n    var temp = 0;\n\n    for (var j = 0; j < layerNum; ++j) {\n      temp += data[j][i][1];\n    }\n\n    if (temp > max) {\n      max = temp;\n    }\n\n    sums.push(temp);\n  }\n\n  for (var k = 0; k < pointNum; ++k) {\n    y0[k] = (max - sums[k]) / 2;\n  }\n\n  max = 0;\n\n  for (var l = 0; l < pointNum; ++l) {\n    var sum = sums[l] + y0[l];\n\n    if (sum > max) {\n      max = sum;\n    }\n  }\n\n  return {\n    y0: y0,\n    max: max\n  };\n}","map":{"version":3,"names":["zrUtil","numberUtil","themeRiverLayout","ecModel","api","eachSeriesByType","seriesModel","data","getData","single","coordinateSystem","layoutInfo","rect","getRect","boundaryGap","get","axis","getAxis","orient","parsePercent","height","doThemeRiverLayout","width","setLayout","count","coordSys","layerSeries","getLayerSeries","timeDim","mapDimension","valueDim","layerPoints","map","singleLayer","indices","idx","pt","dataToPoint","base","computeBaseline","baseLine","y0","ky","max","n","length","m","baseY0","j","setItemLayout","layerIndex","x","y","i","layerNum","pointNum","sums","temp","push","k","l","sum"],"sources":["/home/siyi/Projects/radi-demo/radi-showing/node_modules/echarts/lib/chart/themeRiver/themeRiverLayout.js"],"sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util.js';\nimport * as numberUtil from '../../util/number.js';\nexport default function themeRiverLayout(ecModel, api) {\n  ecModel.eachSeriesByType('themeRiver', function (seriesModel) {\n    var data = seriesModel.getData();\n    var single = seriesModel.coordinateSystem;\n    var layoutInfo = {}; // use the axis boundingRect for view\n\n    var rect = single.getRect();\n    layoutInfo.rect = rect;\n    var boundaryGap = seriesModel.get('boundaryGap');\n    var axis = single.getAxis();\n    layoutInfo.boundaryGap = boundaryGap;\n\n    if (axis.orient === 'horizontal') {\n      boundaryGap[0] = numberUtil.parsePercent(boundaryGap[0], rect.height);\n      boundaryGap[1] = numberUtil.parsePercent(boundaryGap[1], rect.height);\n      var height = rect.height - boundaryGap[0] - boundaryGap[1];\n      doThemeRiverLayout(data, seriesModel, height);\n    } else {\n      boundaryGap[0] = numberUtil.parsePercent(boundaryGap[0], rect.width);\n      boundaryGap[1] = numberUtil.parsePercent(boundaryGap[1], rect.width);\n      var width = rect.width - boundaryGap[0] - boundaryGap[1];\n      doThemeRiverLayout(data, seriesModel, width);\n    }\n\n    data.setLayout('layoutInfo', layoutInfo);\n  });\n}\n/**\n * The layout information about themeriver\n *\n * @param data  data in the series\n * @param seriesModel  the model object of themeRiver series\n * @param height  value used to compute every series height\n */\n\nfunction doThemeRiverLayout(data, seriesModel, height) {\n  if (!data.count()) {\n    return;\n  }\n\n  var coordSys = seriesModel.coordinateSystem; // the data in each layer are organized into a series.\n\n  var layerSeries = seriesModel.getLayerSeries(); // the points in each layer.\n\n  var timeDim = data.mapDimension('single');\n  var valueDim = data.mapDimension('value');\n  var layerPoints = zrUtil.map(layerSeries, function (singleLayer) {\n    return zrUtil.map(singleLayer.indices, function (idx) {\n      var pt = coordSys.dataToPoint(data.get(timeDim, idx));\n      pt[1] = data.get(valueDim, idx);\n      return pt;\n    });\n  });\n  var base = computeBaseline(layerPoints);\n  var baseLine = base.y0;\n  var ky = height / base.max; // set layout information for each item.\n\n  var n = layerSeries.length;\n  var m = layerSeries[0].indices.length;\n  var baseY0;\n\n  for (var j = 0; j < m; ++j) {\n    baseY0 = baseLine[j] * ky;\n    data.setItemLayout(layerSeries[0].indices[j], {\n      layerIndex: 0,\n      x: layerPoints[0][j][0],\n      y0: baseY0,\n      y: layerPoints[0][j][1] * ky\n    });\n\n    for (var i = 1; i < n; ++i) {\n      baseY0 += layerPoints[i - 1][j][1] * ky;\n      data.setItemLayout(layerSeries[i].indices[j], {\n        layerIndex: i,\n        x: layerPoints[i][j][0],\n        y0: baseY0,\n        y: layerPoints[i][j][1] * ky\n      });\n    }\n  }\n}\n/**\n * Compute the baseLine of the rawdata\n * Inspired by Lee Byron's paper Stacked Graphs - Geometry & Aesthetics\n *\n * @param  data  the points in each layer\n */\n\n\nfunction computeBaseline(data) {\n  var layerNum = data.length;\n  var pointNum = data[0].length;\n  var sums = [];\n  var y0 = [];\n  var max = 0;\n\n  for (var i = 0; i < pointNum; ++i) {\n    var temp = 0;\n\n    for (var j = 0; j < layerNum; ++j) {\n      temp += data[j][i][1];\n    }\n\n    if (temp > max) {\n      max = temp;\n    }\n\n    sums.push(temp);\n  }\n\n  for (var k = 0; k < pointNum; ++k) {\n    y0[k] = (max - sums[k]) / 2;\n  }\n\n  max = 0;\n\n  for (var l = 0; l < pointNum; ++l) {\n    var sum = sums[l] + y0[l];\n\n    if (sum > max) {\n      max = sum;\n    }\n  }\n\n  return {\n    y0: y0,\n    max: max\n  };\n}"],"mappings":"AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,KAAKA,MAAZ,MAAwB,0BAAxB;AACA,OAAO,KAAKC,UAAZ,MAA4B,sBAA5B;AACA,eAAe,SAASC,gBAAT,CAA0BC,OAA1B,EAAmCC,GAAnC,EAAwC;EACrDD,OAAO,CAACE,gBAAR,CAAyB,YAAzB,EAAuC,UAAUC,WAAV,EAAuB;IAC5D,IAAIC,IAAI,GAAGD,WAAW,CAACE,OAAZ,EAAX;IACA,IAAIC,MAAM,GAAGH,WAAW,CAACI,gBAAzB;IACA,IAAIC,UAAU,GAAG,EAAjB,CAH4D,CAGvC;;IAErB,IAAIC,IAAI,GAAGH,MAAM,CAACI,OAAP,EAAX;IACAF,UAAU,CAACC,IAAX,GAAkBA,IAAlB;IACA,IAAIE,WAAW,GAAGR,WAAW,CAACS,GAAZ,CAAgB,aAAhB,CAAlB;IACA,IAAIC,IAAI,GAAGP,MAAM,CAACQ,OAAP,EAAX;IACAN,UAAU,CAACG,WAAX,GAAyBA,WAAzB;;IAEA,IAAIE,IAAI,CAACE,MAAL,KAAgB,YAApB,EAAkC;MAChCJ,WAAW,CAAC,CAAD,CAAX,GAAiBb,UAAU,CAACkB,YAAX,CAAwBL,WAAW,CAAC,CAAD,CAAnC,EAAwCF,IAAI,CAACQ,MAA7C,CAAjB;MACAN,WAAW,CAAC,CAAD,CAAX,GAAiBb,UAAU,CAACkB,YAAX,CAAwBL,WAAW,CAAC,CAAD,CAAnC,EAAwCF,IAAI,CAACQ,MAA7C,CAAjB;MACA,IAAIA,MAAM,GAAGR,IAAI,CAACQ,MAAL,GAAcN,WAAW,CAAC,CAAD,CAAzB,GAA+BA,WAAW,CAAC,CAAD,CAAvD;MACAO,kBAAkB,CAACd,IAAD,EAAOD,WAAP,EAAoBc,MAApB,CAAlB;IACD,CALD,MAKO;MACLN,WAAW,CAAC,CAAD,CAAX,GAAiBb,UAAU,CAACkB,YAAX,CAAwBL,WAAW,CAAC,CAAD,CAAnC,EAAwCF,IAAI,CAACU,KAA7C,CAAjB;MACAR,WAAW,CAAC,CAAD,CAAX,GAAiBb,UAAU,CAACkB,YAAX,CAAwBL,WAAW,CAAC,CAAD,CAAnC,EAAwCF,IAAI,CAACU,KAA7C,CAAjB;MACA,IAAIA,KAAK,GAAGV,IAAI,CAACU,KAAL,GAAaR,WAAW,CAAC,CAAD,CAAxB,GAA8BA,WAAW,CAAC,CAAD,CAArD;MACAO,kBAAkB,CAACd,IAAD,EAAOD,WAAP,EAAoBgB,KAApB,CAAlB;IACD;;IAEDf,IAAI,CAACgB,SAAL,CAAe,YAAf,EAA6BZ,UAA7B;EACD,CAxBD;AAyBD;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASU,kBAAT,CAA4Bd,IAA5B,EAAkCD,WAAlC,EAA+Cc,MAA/C,EAAuD;EACrD,IAAI,CAACb,IAAI,CAACiB,KAAL,EAAL,EAAmB;IACjB;EACD;;EAED,IAAIC,QAAQ,GAAGnB,WAAW,CAACI,gBAA3B,CALqD,CAKR;;EAE7C,IAAIgB,WAAW,GAAGpB,WAAW,CAACqB,cAAZ,EAAlB,CAPqD,CAOL;;EAEhD,IAAIC,OAAO,GAAGrB,IAAI,CAACsB,YAAL,CAAkB,QAAlB,CAAd;EACA,IAAIC,QAAQ,GAAGvB,IAAI,CAACsB,YAAL,CAAkB,OAAlB,CAAf;EACA,IAAIE,WAAW,GAAG/B,MAAM,CAACgC,GAAP,CAAWN,WAAX,EAAwB,UAAUO,WAAV,EAAuB;IAC/D,OAAOjC,MAAM,CAACgC,GAAP,CAAWC,WAAW,CAACC,OAAvB,EAAgC,UAAUC,GAAV,EAAe;MACpD,IAAIC,EAAE,GAAGX,QAAQ,CAACY,WAAT,CAAqB9B,IAAI,CAACQ,GAAL,CAASa,OAAT,EAAkBO,GAAlB,CAArB,CAAT;MACAC,EAAE,CAAC,CAAD,CAAF,GAAQ7B,IAAI,CAACQ,GAAL,CAASe,QAAT,EAAmBK,GAAnB,CAAR;MACA,OAAOC,EAAP;IACD,CAJM,CAAP;EAKD,CANiB,CAAlB;EAOA,IAAIE,IAAI,GAAGC,eAAe,CAACR,WAAD,CAA1B;EACA,IAAIS,QAAQ,GAAGF,IAAI,CAACG,EAApB;EACA,IAAIC,EAAE,GAAGtB,MAAM,GAAGkB,IAAI,CAACK,GAAvB,CApBqD,CAoBzB;;EAE5B,IAAIC,CAAC,GAAGlB,WAAW,CAACmB,MAApB;EACA,IAAIC,CAAC,GAAGpB,WAAW,CAAC,CAAD,CAAX,CAAeQ,OAAf,CAAuBW,MAA/B;EACA,IAAIE,MAAJ;;EAEA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,CAApB,EAAuB,EAAEE,CAAzB,EAA4B;IAC1BD,MAAM,GAAGP,QAAQ,CAACQ,CAAD,CAAR,GAAcN,EAAvB;IACAnC,IAAI,CAAC0C,aAAL,CAAmBvB,WAAW,CAAC,CAAD,CAAX,CAAeQ,OAAf,CAAuBc,CAAvB,CAAnB,EAA8C;MAC5CE,UAAU,EAAE,CADgC;MAE5CC,CAAC,EAAEpB,WAAW,CAAC,CAAD,CAAX,CAAeiB,CAAf,EAAkB,CAAlB,CAFyC;MAG5CP,EAAE,EAAEM,MAHwC;MAI5CK,CAAC,EAAErB,WAAW,CAAC,CAAD,CAAX,CAAeiB,CAAf,EAAkB,CAAlB,IAAuBN;IAJkB,CAA9C;;IAOA,KAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,CAApB,EAAuB,EAAES,CAAzB,EAA4B;MAC1BN,MAAM,IAAIhB,WAAW,CAACsB,CAAC,GAAG,CAAL,CAAX,CAAmBL,CAAnB,EAAsB,CAAtB,IAA2BN,EAArC;MACAnC,IAAI,CAAC0C,aAAL,CAAmBvB,WAAW,CAAC2B,CAAD,CAAX,CAAenB,OAAf,CAAuBc,CAAvB,CAAnB,EAA8C;QAC5CE,UAAU,EAAEG,CADgC;QAE5CF,CAAC,EAAEpB,WAAW,CAACsB,CAAD,CAAX,CAAeL,CAAf,EAAkB,CAAlB,CAFyC;QAG5CP,EAAE,EAAEM,MAHwC;QAI5CK,CAAC,EAAErB,WAAW,CAACsB,CAAD,CAAX,CAAeL,CAAf,EAAkB,CAAlB,IAAuBN;MAJkB,CAA9C;IAMD;EACF;AACF;AACD;AACA;AACA;AACA;AACA;AACA;;;AAGA,SAASH,eAAT,CAAyBhC,IAAzB,EAA+B;EAC7B,IAAI+C,QAAQ,GAAG/C,IAAI,CAACsC,MAApB;EACA,IAAIU,QAAQ,GAAGhD,IAAI,CAAC,CAAD,CAAJ,CAAQsC,MAAvB;EACA,IAAIW,IAAI,GAAG,EAAX;EACA,IAAIf,EAAE,GAAG,EAAT;EACA,IAAIE,GAAG,GAAG,CAAV;;EAEA,KAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,QAApB,EAA8B,EAAEF,CAAhC,EAAmC;IACjC,IAAII,IAAI,GAAG,CAAX;;IAEA,KAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,QAApB,EAA8B,EAAEN,CAAhC,EAAmC;MACjCS,IAAI,IAAIlD,IAAI,CAACyC,CAAD,CAAJ,CAAQK,CAAR,EAAW,CAAX,CAAR;IACD;;IAED,IAAII,IAAI,GAAGd,GAAX,EAAgB;MACdA,GAAG,GAAGc,IAAN;IACD;;IAEDD,IAAI,CAACE,IAAL,CAAUD,IAAV;EACD;;EAED,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,QAApB,EAA8B,EAAEI,CAAhC,EAAmC;IACjClB,EAAE,CAACkB,CAAD,CAAF,GAAQ,CAAChB,GAAG,GAAGa,IAAI,CAACG,CAAD,CAAX,IAAkB,CAA1B;EACD;;EAEDhB,GAAG,GAAG,CAAN;;EAEA,KAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,QAApB,EAA8B,EAAEK,CAAhC,EAAmC;IACjC,IAAIC,GAAG,GAAGL,IAAI,CAACI,CAAD,CAAJ,GAAUnB,EAAE,CAACmB,CAAD,CAAtB;;IAEA,IAAIC,GAAG,GAAGlB,GAAV,EAAe;MACbA,GAAG,GAAGkB,GAAN;IACD;EACF;;EAED,OAAO;IACLpB,EAAE,EAAEA,EADC;IAELE,GAAG,EAAEA;EAFA,CAAP;AAID"},"metadata":{},"sourceType":"module"}